# Lab2说明

## 如何处理注释？

遇到一个/*的时候，转入< COMMENT >状态，同时由于Tiger语言是支持多层级的注释的，所以需要将此时Scanner类的comment_level_加1.在进入了< COMMENT >状态之后，分为以下几种情况

-   再次碰到一个/*, 增加注释的层级
-   碰到一个*/,减少注释的层级
-   其它输入(除换行符以外) . 跳过
-   换行符\n, 除了跳过以外，还需要将errormsg Newline一下，行号统计上进行换行

## 如何处理字符串？

遇到一个"的时候，转入< STR >状态。进入< STR >状态以后，分为以下几种情况

-   遇到非转义字符的时候，将匹配上的字符串添加到Scanner类中的string_buf_的末尾
-   遇到转义字符的\时，进入< STR_ESC >状态，用于识别转义字符，转义字符有以下几种:碰到n, t, ", \就直接在string_buf_中加入对应的char；碰到三个数字，代表加入ascii码值为这个的char；碰到非格式化字符并且以\结尾，将忽略这部分；在碰到^的时候进入识别控制字符的状态< STR_ESC_CNTL >，若后面跟的是A-Z, [, ], \, ^, _加入相对应的ascii码值的字符

-   在此碰到"时候代表字符串结束了，将缓存在string_buf_ 中的内容利用setMatched()写入这一个token的值当中，并且将string_buf_清空，同时回到初始状态，返回这个token类型为string

## 错误处理

利用<*> . 写在最后，代表该输入不能被以上所有pattern所识别，代表出错了，不符合Tiger语言的文法规则。就会进入这个状态，在自动机中相当于一个trap，然后打印出出错的token位置。

## EOF处理

查看了生成的lex.cc文件, 其中ScannerBase有这么一个成员函数continue__用来实现只要读到的不是EOF就持续读入，所以我的.lex文件中不用处理EOF，因为它根本不会被读进来。

```c++
void ScannerBase::continue__(int ch)
{
    d_state = d_nextState;

    if (ch != AT_EOF)
        d_matched += ch;
}
```



## 其它

关于何时应该调用errormsg->Newline()? 存在一种情况就是在字符串中使用了转义序列\f_ _ _ f\中间是一个或者多个以上的格式化字符，如果在这个应当被忽略的序列中存在换行符，它是否应该被记为新的一行？是否需要调用errormsg->Newline()?查看源码Newline()这个成员函数的作用是增加ErrorMsg中的line_num_，但是检测的程序里好像并没有检查这个变量的设置情况？(查看了一下源码，似乎这个变量只有在出错的时候会显示行号)不知道这种情况应该如何处理？